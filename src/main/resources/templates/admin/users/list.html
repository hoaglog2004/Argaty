<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layouts/admin}"
>
  <head>
    <title>Quản lý người dùng</title>
  </head>

  <body>
    <div layout:fragment="content">
      <div class="admin-page-header">
        <h1 class="admin-page-title">Quản lý người dùng</h1>
      </div>

      <div class="admin-filters">
        <div class="admin-search">
          <i class="bx bx-search"></i>
          <input
            type="text"
            class="form-control"
            placeholder="Tìm tên, email, SĐT..."
            th:value="${searchKeyword}"
          />
        </div>
        <select
          class="form-control form-select admin-filter-select"
          name="role"
          data-param="role"
        >
          <option value="">Tất cả vai trò</option>
          <option value="USER" th:selected="${selectedRole == 'USER'}">
            Khách hàng
          </option>
          <option value="STAFF" th:selected="${selectedRole == 'STAFF'}">
            Nhân viên
          </option>
          <option value="ADMIN" th:selected="${selectedRole == 'ADMIN'}">
            Admin
          </option>
        </select>
      </div>

      <div class="admin-table-wrapper">
        <table class="admin-table">
          <thead>
            <tr>
              <th>Người dùng</th>
              <th>Email</th>
              <th>SĐT</th>
              <th>Vai trò</th>
              <th>Đơn hàng</th>
              <th>Ngày tham gia</th>
              <th>Trạng thái</th>
              <th>Thao tác</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="user : ${users.content}">
              <td>
                <div class="d-flex align-center gap-3">
                  <div
                    style="
                      width: 40px;
                      height: 40px;
                      border-radius: 50%;
                      background: var(--gradient-nebula);
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      overflow: hidden;
                    "
                  >
                    <img
                      th:if="${user.avatar}"
                      th:src="${user.avatar}"
                      style="width: 100%; height: 100%; object-fit: cover"
                    />
                    <span
                      th:unless="${user.avatar}"
                      style="color: #fff; font-weight: 600"
                      th:text="${#strings.substring(user.fullName, 0, 1)}"
                      >U</span
                    >
                  </div>
                  <span th:text="${user.fullName}">Tên</span>
                </div>
              </td>
              <td th:text="${user.email}">email@example.com</td>
              <td th:text="${user.phone != null} ? ${user.phone} : '-'">-</td>
              <td>
                <span
                  th:if="${user.role.name() == 'ADMIN'}"
                  class="status-badge"
                  style="background: rgba(239, 68, 68, 0.15); color: #ef4444"
                  >Admin</span
                >
                <span
                  th:if="${user.role.name() == 'STAFF'}"
                  class="status-badge"
                  style="background: rgba(245, 158, 11, 0.15); color: #f59e0b"
                  >Staff</span
                >
                <span
                  th:if="${user.role.name() == 'USER'}"
                  class="status-badge"
                  style="background: rgba(34, 211, 238, 0.15); color: #22d3ee"
                  >User</span
                >
              </td>
              <td th:text="${user.orderCount}">0</td>
              <td th:text="${#temporals.format(user.createdAt, 'dd/MM/yyyy')}">
                01/01/2024
              </td>
              <td>
                <span
                  th:if="${user.isEnabled}"
                  class="status-badge status-badge--completed"
                  >Active</span
                >
                <span
                  th:unless="${user.isEnabled}"
                  class="status-badge status-badge--cancelled"
                  >Blocked</span
                >
              </td>
              <td>
                <div class="table-actions">
                  <a
                    th:href="@{/admin/users/{id}(id=${user.id})}"
                    class="table-action-btn"
                    title="Chi tiết"
                  >
                    <i class="bx bx-show"></i>
                  </a>
                  <form
                    th:action="@{/admin/users/{id}/toggle-status(id=${user.id})}"
                    method="post"
                    style="display: inline"
                  >
                    <input
                      type="hidden"
                      th:name="${_csrf.parameterName}"
                      th:value="${_csrf.token}"
                    />
                    <button
                      type="submit"
                      class="table-action-btn"
                      th:title="${user.isEnabled} ? 'Khóa' : 'Mở khóa'"
                    >
                      <i
                        th:class="${user.isEnabled} ? 'bx bx-lock' : 'bx bx-lock-open'"
                      ></i>
                    </button>
                  </form>
                </div>
              </td>
            </tr>
            <tr th:if="${users. content == null || users.content.isEmpty()}">
              <td colspan="8" class="text-center text-muted p-5">
                Không có người dùng nào
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="d-flex justify-between align-center mt-4">
        <p class="text-muted mb-0">
          Hiển thị <span th:text="${users.content.size()}">0</span> /
          <span th:text="${users.totalElements}">0</span> người dùng
        </p>
        <th:block
          th:replace="~{fragments/pagination :: pagination(${users}, '/admin/users')}"
        ></th:block>
      </div>
    </div>
  </body>
</html>
