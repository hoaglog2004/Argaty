<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layouts/admin}"
>
  <head>
    <title>Quản lý danh mục</title>
  </head>

  <body>
    <div layout:fragment="content">
      <div class="admin-page-header">
        <h1 class="admin-page-title">Quản lý danh mục</h1>
        <div class="admin-page-actions">
          <a th:href="@{/admin/categories/create}" class="btn btn-primary">
            <i class="bx bx-plus"></i> Thêm danh mục
          </a>
        </div>
      </div>

      <div class="admin-table-wrapper">
        <table class="admin-table">
          <thead>
            <tr>
              <th style="width: 60px">STT</th>
              <th>Danh mục</th>
              <th>Slug</th>
              <th>Danh mục cha</th>
              <th>Số SP</th>
              <th>Thứ tự</th>
              <th>Trạng thái</th>
              <th>Thao tác</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="cat, stat : ${categories.content}">
              <td th:text="${stat.index + 1}">1</td>
              <td>
                <div class="d-flex align-center gap-3">
                  <div
                    class="category-visual"
                    style="
                      width: 40px;
                      height: 40px;
                      border-radius: 8px;
                      overflow: hidden;
                      background: rgba(139, 92, 246, 0.1);
                      display: flex;
                      align-items: center;
                      justify-content: center;
                    "
                  >
                    <img
                      th:if="${cat.image != null && cat.image.length() > 3}"
                      th:src="${cat.image}"
                      alt="Icon"
                      style="width: 100%; height: 100%; object-fit: cover"
                    />

                    <i
                      th:unless="${cat.image != null && cat.image.length() > 3}"
                      th:class="${cat.icon != null && cat.icon.contains('bx ')} ? ${cat.icon} : ('bx ' + ${cat.icon})"
                      style="font-size: 20px; color: var(--primary)"
                    >
                    </i>
                  </div>
                  <span th:text="${cat.name}">Danh mục</span>
                </div>
              </td>
              <td><code th:text="${cat.slug}">slug</code></td>
              <td
                th:text="${cat.parentName != null} ? ${cat.parentName} :  '-'"
              >
                -
              </td>
              <td th:text="${cat.productCount}">0</td>
              <td th:text="${cat.displayOrder}">0</td>
              <td>
                <span
                  th:if="${cat.isActive}"
                  class="status-badge status-badge--completed"
                  >Active</span
                >
                <span
                  th:unless="${cat.isActive}"
                  class="status-badge status-badge--cancelled"
                  >Inactive</span
                >
              </td>
              <td>
                <div class="table-actions">
                  <a
                    th:href="@{/admin/categories/{id}/edit(id=${cat.id})}"
                    class="table-action-btn edit"
                    title="Sửa"
                  >
                    <i class="bx bx-edit"></i>
                  </a>
                  <form
                    th:action="@{/admin/categories/{id}/delete(id=${cat.id})}"
                    method="post"
                    style="display: inline"
                  >
                    <input
                      type="hidden"
                      th:name="${_csrf.parameterName}"
                      th:value="${_csrf.token}"
                    />
                    <button
                      type="button"
                      class="table-action-btn delete"
                      title="Xóa"
                      onclick="confirmDelete('Bạn có chắc muốn xóa danh mục này? ', () => this.closest('form').submit())"
                    >
                      <i class="bx bx-trash"></i>
                    </button>
                  </form>
                </div>
              </td>
            </tr>
            <tr
              th:if="${categories.content == null || categories.content.isEmpty()}"
            >
              <td colspan="8" class="text-center text-muted p-5">
                Chưa có danh mục nào
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <th:block
        th:replace="~{fragments/pagination :: pagination(${categories}, '/admin/categories')}"
      ></th:block>
    </div>
  </body>
</html>
