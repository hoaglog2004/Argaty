<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <body>
    <header th:fragment="header" class="header" id="header">
      <div class="container">
        <div class="header__inner">
          <a th:href="@{/}" class="header__logo">
            <div class="header__logo-icon">
              <i class="bx bx-planet"></i>
            </div>
            <span class="header__logo-text">ARGATY</span>
          </a>

          <nav class="header__nav">
            <a
              th:href="@{/}"
              class="nav-link"
              th:classappend="${currentPage == 'home'} ? 'active'"
              >Trang chủ</a
            >
            <a
              th:href="@{/products}"
              class="nav-link"
              th:classappend="${currentPage == 'products'} ? 'active'"
              >Sản phẩm</a
            >
            <a
              th:href="@{/about}"
              class="nav-link"
              th:classappend="${currentPage == 'about'} ? 'active'"
              >Giới thiệu</a
            >
            <a
              th:href="@{/contact}"
              class="nav-link"
              th:classappend="${currentPage == 'contact'} ? 'active'"
              >Liên hệ</a
            >
          </nav>

          <div class="header__search">
            <form
              th:action="@{/products}"
              method="get"
              class="header__search-form"
            >
              <i class="bx bx-search header__search-icon"></i>
              <input
                type="text"
                name="q"
                class="header__search-input"
                placeholder="Tìm kiếm sản phẩm..."
                th:value="${searchKeyword}"
              />
              <button type="submit" class="header__search-btn">
                <i class="bx bx-search"></i>
              </button>
            </form>
          </div>

          <div class="header__actions">
            <a
              th:href="@{/wishlist}"
              class="header__action-btn btn-wishlist"
              title="Yêu thích"
            >
              <i class="bx bx-heart"></i>
            </a>

            <div
              class="header__action-item header__cart-wrapper"
              id="headerCartPanel"
              th:fragment="headerCartPanel"
            >
              <a
                th:href="@{/cart}"
                class="header__action-btn btn-cart"
                title="Giỏ hàng"
              >
                <i class="bx bx-cart"></i>
                <span
                  class="badge-count"
                  th:if="${session.cartItemCount != null && session.cartItemCount > 0}"
                  th:text="${session.cartItemCount}"
                  >0</span
                >
              </a>

              <div class="header__cart-dropdown">
                <div class="header__cart-header">
                  <span th:if="${session.cartItemCount > 0}"
                    >Sản phẩm mới thêm</span
                  >
                  <span th:unless="${session.cartItemCount > 0}"
                    >Giỏ hàng trống</span
                  >
                </div>

                <div
                  class="header__cart-items"
                  th:if="${session.miniCartItems != null && !session.miniCartItems.isEmpty()}"
                >
                  <div
                    th:each="item : ${session.miniCartItems}"
                    class="header__cart-item"
                  >
                    <img
                      th:src="${item.imageUrl}"
                      alt="Product"
                      class="header__cart-img"
                    />

                    <div class="header__cart-info">
                      <a
                        th:href="@{'/products/' + ${item.slug}}"
                        class="header__cart-name"
                        th:text="${item.name}"
                        >Tên sản phẩm</a
                      >

                      <div class="header__cart-price">
                        <span th:text="${item.quantity}">1</span> x
                        <span
                          th:text="${#numbers.formatDecimal(item.price, 0, 'COMMA', 0, 'POINT')} + ' ₫'"
                          >100.000 ₫</span
                        >
                      </div>
                    </div>
                  </div>
                </div>

                <div
                  th:if="${session.miniCartItems == null || session.miniCartItems.isEmpty()}"
                  style="
                    padding: 30px;
                    text-align: center;
                    color: var(--text-muted);
                  "
                >
                  <i
                    class="bx bx-cart"
                    style="font-size: 40px; margin-bottom: 10px; opacity: 0.5"
                  ></i>
                  <p>Chưa có sản phẩm nào</p>
                </div>

                <div
                  class="header__cart-footer"
                  th:if="${session.cartItemCount > 0}"
                >
                  <div class="header__cart-total">
                    <span>Tổng cộng:</span>
                    <span
                      class="header__cart-total-price"
                      th:text="${#numbers.formatDecimal(session.cartTotal ?: 0, 0, 'COMMA', 0, 'POINT')} + ' ₫'"
                      >0 ₫</span
                    >
                  </div>
                  <a th:href="@{/cart}" class="btn btn-primary btn-block btn-sm"
                    >Xem giỏ hàng</a
                  >
                </div>
              </div>
            </div>

            <a
              sec:authorize="!isAuthenticated()"
              th:href="@{/auth/login}"
              class="btn btn-primary btn-sm"
              style="border-radius: 20px"
            >
              <i class="bx bx-log-in"></i> <span>Đăng nhập</span>
            </a>

            <div sec:authorize="isAuthenticated()" class="header__user">
              <div class="header__dropdown">
                <div class="header__user-btn" role="button">
                  <div class="header__user-avatar">
                    <img
                      th:if="${session.currentUserAvatar}"
                      th:src="${session.currentUserAvatar}"
                      alt="Avatar"
                    />
                    <i
                      th:unless="${session.currentUserAvatar}"
                      class="bx bx-user"
                      style="color: #fff; font-size: 20px"
                    ></i>
                  </div>
                  <span class="header__username" sec:authentication="name"
                    >User</span
                  >
                  <i class="bx bx-chevron-down"></i>
                </div>

                <div class="header__dropdown-menu">
                  <a
                    sec:authorize="hasRole('ADMIN')"
                    th:href="@{/admin}"
                    class="header__dropdown-item"
                  >
                    <i class="bx bx-cog"></i> Trang Quản trị
                  </a>
                  <a th:href="@{/profile}" class="header__dropdown-item">
                    <i class="bx bx-user-circle"></i> Hồ sơ
                  </a>
                  <a th:href="@{/profile/orders}" class="header__dropdown-item">
                    <i class="bx bx-package"></i> Đơn hàng
                  </a>
                  <div class="header__dropdown-divider"></div>
                  <form
                    th:action="@{/auth/logout}"
                    method="post"
                    class="header__logout-form"
                  >
                    <input
                      type="hidden"
                      th:name="${_csrf.parameterName}"
                      th:value="${_csrf.token}"
                    />
                    <button
                      type="submit"
                      class="header__dropdown-item header__logout-btn"
                    >
                      <i class="bx bx-log-out"></i> Đăng xuất
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
  </body>
</html>
