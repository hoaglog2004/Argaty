<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <head>
    <meta charset="UTF-8" />
  </head>
  <body>
    <!-- Header Fragment - CÓ th:fragment="header" -->
    <header th:fragment="header" class="header" id="header">
      <div class="container">
        <div class="header__inner">
          <!-- Logo -->
          <a th:href="@{/}" class="header__logo">
            <div class="header__logo-icon">
              <i class="bx bx-planet"></i>
            </div>
            <span class="header__logo-text">ARGATY</span>
          </a>

          <!-- Navigation -->
          <nav class="header__nav">
            <a th:href="@{/}" class="header__nav-link">
              <span>Trang chủ</span>
            </a>
            <a th:href="@{/products}" class="header__nav-link">
              <span>Sản phẩm</span>
            </a>
            <a th:href="@{/about}" class="header__nav-link">
              <span>Giới thiệu</span>
            </a>
            <a th:href="@{/contact}" class="header__nav-link">
              <span>Liên hệ</span>
            </a>
          </nav>

          <!-- Search -->
          <div class="header__search">
            <form
              th:action="@{/products}"
              method="get"
              class="header__search-form"
            >
              <input
                type="text"
                name="q"
                class="header__search-input"
                placeholder="Tìm kiếm sản phẩm..."
              />
              <button type="submit" class="header__search-btn">
                <i class="bx bx-search"></i>
              </button>
            </form>
          </div>

          <!-- Actions -->
          <div class="header__actions">
            <a
              th:href="@{/wishlist}"
              class="header__action-btn"
              title="Yêu thích"
            >
              <i class="bx bx-heart"></i>
            </a>
            <a th:href="@{/cart}" class="header__action-btn" title="Giỏ hàng">
              <i class="bx bx-cart"></i>
            </a>

            <!-- Hiển thị khi CHƯA đăng nhập -->
            <a
              sec:authorize="!isAuthenticated()"
              th:href="@{/auth/login}"
              class="btn btn-primary btn-sm"
            >
              <i class="bx bx-log-in"></i> Đăng nhập
            </a>

            <!-- Hiển thị khi ĐÃ đăng nhập -->
            <div sec:authorize="isAuthenticated()" class="header__user-menu">
              <!-- Dropdown User -->
              <div class="header__dropdown">
                <a
                  href="#"
                  class="header__action-btn header__dropdown-toggle"
                  title="Tài khoản"
                >
                  <i class="bx bx-user"></i>
                  <span class="header__username" sec:authentication="name"
                    >User</span
                  >
                </a>
                <div class="header__dropdown-menu">
                  <!-- Admin Menu Items -->
                  <a 
                    sec:authorize="hasRole('ADMIN')"
                    th:href="@{/admin}" 
                    class="header__dropdown-item">
                    <i class="bx bx-cog"></i> Trang Quản trị
                  </a>
                  
                  <!-- Staff Menu Items -->
                  <a 
                    sec:authorize="hasRole('STAFF') and !hasRole('ADMIN')"
                    th:href="@{/staff}" 
                    class="header__dropdown-item">
                    <i class="bx bx-briefcase"></i> Trang Nhân viên
                  </a>
                  
                  <!-- Common Menu Items for All Users -->
                  <a th:href="@{/profile}" class="header__dropdown-item">
                    <i class="bx bx-user-circle"></i> Hồ sơ
                  </a>
                  <a th:href="@{/profile/orders}" class="header__dropdown-item">
                    <i class="bx bx-package"></i> Đơn hàng
                  </a>
                  
                  <!-- Wishlist for Regular Users -->
                  <a 
                    sec:authorize="!hasRole('ADMIN') and !hasRole('STAFF')"
                    th:href="@{/wishlist}" 
                    class="header__dropdown-item">
                    <i class="bx bx-heart"></i> Yêu thích
                  </a>
                  
                  <div class="header__dropdown-divider"></div>
                  <form
                    th:action="@{/auth/logout}"
                    method="post"
                    class="header__logout-form"
                  >
                    <input
                      type="hidden"
                      th:name="${_csrf.parameterName}"
                      th:value="${_csrf.token}"
                    />
                    <button
                      type="submit"
                      class="header__dropdown-item header__logout-btn"
                    >
                      <i class="bx bx-log-out"></i> Đăng xuất
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
  </body>
</html>
